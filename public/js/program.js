const curriculum = {
    8: {
        'Български език и литература': {
            description: '',
            category: 'general'
        },
        'Английски език': {
            description: '',
            category: 'general'
        },
        'Математика': {
            description: '',
            category: 'general'
        },
        'Информационни технологии': {
            description: '',
            category: 'general'
        },
        'История и цивилизации': {
            description: '',
            category: 'general'
        },
        'География и икономика': {
            description: '',
            category: 'general'
        },
        'Философия': {
            description: '',
            category: 'general'
        },
        'Биология и здравно образование': {
            description: '',
            category: 'general'
        },
        'Физика и астрономия': {
            description: '',
            category: 'general'
        },
        'Химия и опазване на околната среда': {
            description: '',
            category: 'general'
        },
        'Музика': {
            description: '',
            category: 'general'
        },
        'Изобразително изкуство': {
            description: '',
            category: 'general'
        },
        'Физическо възпитание и спорт': {
            description: '',
            category: 'general'
        },
        'Предприемачество': {
            description: '',
            category: 'general-professional'
        }
    },
    9: {
        'Увод в програмирането': {
            description: '',
            category: 'professional'
        },
        'Програмиране': {
            description: '',
            category: 'professional'
        },
        'Увод в обектно-ориентираното програмиране': {
            description: '',
            category: 'professional'
        },
        'Информационни технологии': {
            description: '',
            category: 'general'
        },
        'Български език и литература': {
            description: '',
            category: 'general'
        },
        'Английски език': {
            description: '',
            category: 'general'
        },
        'Немски език': {
            description: '',
            category: 'general'
        },
        'Математика': {
            description: '',
            category: 'general'
        },
        'История и цивилизации': {
            description: '',
            category: 'general'
        },
        'География и икономика': {
            description: '',
            category: 'general'
        },
        'Философия': {
            description: '',
            category: 'general'
        },
        'Биология и здравно образование': {
            description: '',
            category: 'general'
        },
        'Физика и астрономия': {
            description: '',
            category: 'general'
        },
        'Химия и опазване на околната среда': {
            description: '',
            category: 'general'
        },
        'Изобразително изкуство': {
            description: '',
            category: 'general'
        },
        'Физическо възпитание и спорт': {
            description: '',
            category: 'general'
        },
        'Здравословни и безопасни условия на труд': {
            description: '',
            category: 'general-professional'
        }
    },
    10: {
        'Увод в алгоритмите и структурите от данни': {
            description: '',
            category: 'professional'
        },
        'Програмиране на микроконтролери': {
            description: '',
            category: 'advanced-professional'
        },
        'Информационни технологии': {
            description: '',
            category: 'general'
        },
        'Производствена практика': {
            description: '',
            category: 'practice'
        },
        'Български език и литература': {
            description: '',
            category: 'general'
        },
        'Английски език': {
            description: '',
            category: 'general'
        },
        'Немски език': {
            description: '',
            category: 'general'
        },
        'Математика': {
            description: '',
            category: 'general'
        },
        'История и цивилизации': {
            description: '',
            category: 'general'
        },
        'География и икономика': {
            description: '',
            category: 'general'
        },
        'Философия': {
            description: '',
            category: 'general'
        },
        'Биология и здравно образование': {
            description: '',
            category: 'general'
        },
        'Физика и астрономия': {
            description: '',
            category: 'general'
        },
        'Химия и опазване на околната среда': {
            description: '',
            category: 'general'
        },
        'Икономика': {
            description: '',
            category: 'general-professional'
        },
        'Физическо възпитание и спорт': {
            description: '',
            category: 'general'
        }
    },
    11: {
        'Обектно-ориентирано програмиране': {
            description: '',
            category: 'professional'
        },
        'Разработка на софтуер': {
            description: '',
            category: 'professional'
        },
        'Функционално програмиране': {
            description: '',
            category: 'specific-professional'
        },
        'Бази данни': {
            description: '',
            category: 'professional'
        },
        'Програмиране за вградени системи': {
            description: '',
            category: 'specific-professional'
        },
        'Математически основи на програмирането': {
            description: '',
            category: 'specific-professional'
        },
        'Операционни системи': {
            description: '',
            category: 'specific-professional'
        },
        'Конкурентно програмиране': {
            description: '',
            category: 'specific-professional'
        },
        'Български език и литература': {
            description: '',
            category: 'general'
        },
        'Чужд език по професията': {
            description: '',
            category: 'general-professional'
        },
        'Немски език': {
            description: '',
            category: 'general'
        },
        'Математика': {
            description: '',
            category: 'general'
        },
        'Гражданско образование': {
            description: '',
            category: 'general'
        },
        'Физическо възпитание и спорт': {
            description: '',
            category: 'general'
        }
    },
    12: {
        'Алгоритми и структури от данни': {
            description: '',
            category: 'specific-professional'
        },
        'Функционално програмиране': {
            description: '',
            category: 'specific-professional'
        },
        'Интернет програмиране': {
            description: '',
            category: 'specific-professional'
        },
        'Софтуерно инженерство': {
            description: '',
            category: 'specific-professional'
        },
        'Български език и литература': {
            description: '',
            category: 'general'
        },
        'Чужд език по професията': {
            description: '',
            category: 'general-professional'
        },
        'Немски език': {
            description: '',
            category: 'general'
        },
        'Математика': {
            description: '',
            category: 'general'
        },
        'Гражданско образование': {
            description: '',
            category: 'general'
        },
        'Физическо възпитание и спорт': {
            description: '',
            category: 'general'
        }
    }
};

// Онлайн икони за различните предмети
const subjectIcons = {
    'Софтуерно инженерство': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/code-slash.svg',
    'Увод в алгоритмите и структурите от данни': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/diagram-3.svg',
    'Програмиране': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/braces.svg',
    'Обектно-ориентирано програмиране': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/boxes.svg',
    'Увод в обектно-ориентираното програмиране': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/box.svg',
    'Бази данни': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/database.svg',
    'Разработка на софтуер': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/code-square.svg',
    'Операционни системи': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/cpu.svg',
    'Конкурентно програмиране': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/code-slash.svg',
    'Функционално програмиране': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/braces-asterisk.svg',
    'Интернет програмиране': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/globe.svg',
    'Програмиране за вградени системи': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/cpu-fill.svg',
    'Програмиране на микроконтролери': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/motherboard.svg',
    'Български език и литература': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/book.svg',
    'Математика': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/calculator.svg',
    'Английски език': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/translate.svg',
    'Немски език': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/translate.svg',
    'Физика и астрономия': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/stars.svg',
    'Увод в програмирането': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/code.svg',
    'Математически основи на програмирането': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/infinity.svg',
    'Алгоритми и структури от данни': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/diagram-2.svg',
    'Чужд език по професията': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/chat-square-text.svg',
    'География и икономика': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/globe-europe-africa.svg',
    'Биология и здравно образование': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/tree.svg',
    'Химия и опазване на околната среда': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/droplet.svg',
    'История и цивилизации': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/clock-history.svg',
    'Философия': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/lightbulb.svg',
    'Гражданско образование': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/people.svg',
    'Физическо възпитание и спорт': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/trophy.svg',
    'Предприемачество': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/briefcase.svg',
    'Здравословни и безопасни условия на труд': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/shield-check.svg',
    'Музика': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/music-note.svg',
    'Изобразително изкуство': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/palette.svg',
    'Информационни технологии': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/pc-display.svg',
    'Производствена практика': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/briefcase.svg',
    'Икономика': 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/bar-chart.svg'
};

let currentGrade = null;
let isAnimating = false;

function showGrade(grade) {
    if (currentGrade === grade || isAnimating) return;
    isAnimating = true;
    
    const gradeTitle = document.getElementById('grade-title');
    const subjectsDiv = document.getElementById('subjects');
    
    // Анимация за изчезване
    subjectsDiv.style.opacity = '0';
    subjectsDiv.style.transform = 'translateY(-20px)';
    
    // Анимация за заглавието
    gradeTitle.classList.remove('animate');
    void gradeTitle.offsetWidth; // Форсираме reflow
    gradeTitle.classList.add('animate');
    
    setTimeout(() => {
        gradeTitle.textContent = `${grade} клас`;
        subjectsDiv.innerHTML = '';

        const subjects = curriculum[grade];
        
        // Проверка за празни данни
        if (!subjects || Object.keys(subjects).length === 0) {
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'empty-message';
            emptyMessage.textContent = 'Информацията за този клас скоро ще бъде добавена.';
            subjectsDiv.appendChild(emptyMessage);
            subjectsDiv.style.opacity = '1';
            subjectsDiv.style.transform = 'translateY(0)';
            isAnimating = false;
            return;
        }

        // Създаваме легенда за видовете предмети
        const legend = document.createElement('div');
        legend.className = 'legend';
        
        // Организираме легендата по две категории на ред
        legend.innerHTML = `
            <div class="legend-item">
                <div class="legend-color legend-professional"></div>
                <span>Отраслова професионална подготовка</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-specific-professional"></div>
                <span>Специфична професионална подготовка</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-advanced-professional"></div>
                <span>Разширена професионална подготовка</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-general-professional"></div>
                <span>Обща професионална подготовка</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-practise"></div>
                <span>Производствена практика</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-general"></div>
                <span>Общообразователна подготовка</span>
            </div>
        `;
        
        // Добавяме стил за организация по две на ред
        const legendStyle = document.createElement('style');
        legendStyle.textContent = `
            .legend {
                display: flex;
                flex-wrap: wrap;
            }
            .legend-item {
                width: 40%;
                box-sizing: border-box;
                padding-right: 10px;
            }
        `;
        document.head.appendChild(legendStyle);
        
        subjectsDiv.appendChild(legend);

        // Създаваме контейнер за подредба
        const gridContainer = document.createElement('div');
        gridContainer.className = 'subjects-grid';
        subjectsDiv.appendChild(gridContainer);

        // Дефинираме реда на категориите
        const categoryOrder = {
            'professional': 1,
            'specific-professional': 2,
            'advanced-professional': 3,
            'general-professional': 4,
            'practice': 5,
            'general': 6
        };

        // Сортираме предметите само според категориите
        const sortedSubjects = Object.entries(subjects).sort((a, b) => {
            const categoryA = a[1].category;
            const categoryB = b[1].category;
            
            // Сортиране само по категория
            return categoryOrder[categoryA] - categoryOrder[categoryB];
        });
        
        let delay = 0;

        for (const [subject, data] of sortedSubjects) {
            const subjectElement = document.createElement('div');
            subjectElement.className = 'subject';
            subjectElement.style.opacity = '0';
            subjectElement.style.transform = 'translateY(20px)';
            subjectElement.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
            subjectElement.style.transitionDelay = `${delay}s`;
            
            const iconUrl = subjectIcons[subject] || 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/question-circle.svg';
            const categoryName = getCategoryName(data.category);
            
            subjectElement.innerHTML = `
                <span class="subject-category ${data.category}">${categoryName}</span>
                <h3>
                    <span class="subject-icon">
                        <img src="${iconUrl}" alt="${subject}" class="icon-img" width="24" height="24">
                    </span>
                    ${subject}
                </h3>
                <p>${data.description}</p>
            `;
            
            gridContainer.appendChild(subjectElement);
            delay += 0.1;
            
            // Форсираме reflow за анимацията
            subjectElement.offsetHeight;
            
            setTimeout(() => {
                subjectElement.style.opacity = '1';
                subjectElement.style.transform = 'translateY(0)';
            }, 50);
        }
        
        // Показваме съдържанието с анимация
        subjectsDiv.style.opacity = '1';
        subjectsDiv.style.transform = 'translateY(0)';
        
        setTimeout(() => {
            isAnimating = false;
        }, delay * 1000 + 500);
    }, 300);

    // Активен бутон с плавна анимация
    document.querySelectorAll('.buttons button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.includes(grade.toString())) {
            btn.classList.add('active');
        }
    });

    currentGrade = grade;
}

// Добавяме клавиатурна навигация
document.addEventListener('keydown', (e) => {
    if (currentGrade && !isAnimating) {
        if (e.key === 'ArrowRight' || e.key === 'ArrowUp') {
            const nextGrade = Math.min(currentGrade + 1, 12);
            if (nextGrade !== currentGrade) showGrade(nextGrade);
        } else if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') {
            const prevGrade = Math.max(currentGrade - 1, 8);
            if (prevGrade !== currentGrade) showGrade(prevGrade);
        }
    }
});

// Функция, която превръща кода на категорията в текст за показване
function getCategoryName(category) {
    const categoryNames = {
        'professional': 'Отраслова професионална подготовка',
        'specific-professional': 'Специфична професионална подготовка',
        'advanced-professional': 'Разширена професионална подготовка',
        'general-professional': 'Обща професионална подготовка',
        'practice': 'Производствена практика',
        'general': 'Общообразователна подготовка'
    };
    
    return categoryNames[category] || category;
}

// Инициализация при зареждане
document.addEventListener('DOMContentLoaded', () => {
// Добавяме CSS за иконите
const iconStyles = document.createElement('style');
iconStyles.textContent = `
    .subject-icon {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        vertical-align: middle;
    }
    
    .icon-img {
        width: 24px;
        height: 24px;
        vertical-align: middle;
        margin-right: 8px;
        object-fit: contain;
    }
`;
document.head.appendChild(iconStyles);
    
    // Добавяме линк към Bootstrap Icons
    const iconLink = document.createElement('link');
    iconLink.rel = 'stylesheet';
    iconLink.href = 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css';
    document.head.appendChild(iconLink);
    
    // Добавяме клас за активен бутон при клик
    document.querySelectorAll('.buttons button').forEach(button => {
        button.addEventListener('click', function() {
            if (!isAnimating) {
                const grade = parseInt(this.textContent);
                showGrade(grade);
            }
        });
    });

    // Задаваме начално състояние
    const gradeTitle = document.getElementById('grade-title');
    const subjectsDiv = document.getElementById('subjects');
    
    gradeTitle.textContent = 'Изберете клас';
    gradeTitle.classList.add('initial');
    subjectsDiv.innerHTML = '';
    
    // Добавяме съобщение за начален избор с Bootstrap икона
    const initialMessage = document.createElement('div');
    initialMessage.className = 'empty-message';
    initialMessage.innerHTML = `
        <i class="bi bi-hand-index-thumb" style="font-size: 2rem; margin-bottom: 15px; color: #1a73e8;"></i>
        <p>Моля, изберете клас от бутоните по-горе, за да видите учебната програма.</p>
    `;
    subjectsDiv.appendChild(initialMessage);
});